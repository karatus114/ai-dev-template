# 開発の進め方（ワークフロー）

このドキュメントでは、開発の進め方とベストプラクティスを定義します。

---

## 基本原則

### 1. 機能単位で小さく作る

**一度に大きな機能を作らない**

- ✅ 1機能ごとに：実装→テスト→レビュー→マージ
- ✅ 小さく作って早くフィードバックを得る
- ❌ 大きな機能を一気に作ってまとめてマージ

**良い例**:

```
機能: ユーザー管理

✅ 小さく分割:
1. ユーザー一覧表示
2. ユーザー作成
3. ユーザー編集
4. ユーザー削除

各機能ごとに：実装→レビュー→マージ

❌ 悪い例:
「ユーザー管理機能」を一気に作る
```

---

## フロントエンド先行開発

### Phase 1: 画面モック（フロントエンド）

**まず画面を作る（データはダミー/モック）**

1. **画面デザインを決める**
   - ワイヤーフレームまたはデザインを確認
   - 必要なコンポーネントを洗い出す

2. **ダミーデータで画面を作る**
   - APIはまだ実装しない
   - ハードコードされたダミーデータを使用

3. **動きを確認**
   - 画面遷移が正しいか
   - ユーザー体験が良いか

4. **「これでOK」となったら次へ**

**例（React）**:

```typescript
// ダミーデータ
const dummyUsers = [
  { id: 1, name: 'John Doe', email: 'john@example.com' },
  { id: 2, name: 'Jane Smith', email: 'jane@example.com' },
];

function UserList() {
  return (
    <div>
      {dummyUsers.map((user) => (
        <div key={user.id}>
          {user.name} - {user.email}
        </div>
      ))}
    </div>
  );
}
```

### Phase 2: API設計

**画面に必要なデータを洗い出し、API仕様を決める**

1. **画面で必要なデータを確認**
   - どんなデータが必要か
   - どんな操作が必要か

2. **API仕様を決める**
   - エンドポイント
   - リクエスト形式
   - レスポンス形式

3. **ドキュメントに記載**
   - `CLAUDE.md` の「現状のAPI一覧」セクション
   - または別のAPI仕様書

**例**:

```markdown
## GET /api/users

ユーザー一覧を取得する

### リクエスト

なし

### レスポンス

200 OK

{
  "users": [
    {
      "id": 1,
      "name": "John Doe",
      "email": "john@example.com"
    }
  ]
}
```

### Phase 3: バックエンド実装

**TDDでAPIを実装する**

1. **テスト作成**（`/create-test`）
   - API仕様に基づいてテストを作成

2. **実装**（`/implement-for-test`）
   - テストがパスする実装を作成

3. **テストがパスしたら完了**

詳細は [TESTING.md](TESTING.md) を参照してください。

### Phase 4: 結合

**フロントのダミーデータを実APIに差し替え**

1. **APIクライアントの実装**

```typescript
// Before: ダミーデータ
const dummyUsers = [...];

// After: API呼び出し
const { data: users } = await fetch('/api/users');
```

2. **動作確認**
   - 画面が正しく動作するか
   - エラーケースも確認

3. **完了**

---

## TDDの流れ

詳細は [TESTING.md](TESTING.md) を参照してください。

### 基本フロー

```
1. /create-test
   ↓ テスト作成
2. テスト確認
   ↓ 失敗することを確認
3. /commit
   ↓ テストをコミット
4. /implement-for-test
   ↓ 実装
5. テスト実行
   ↓ パスすることを確認
6. /commit
   ↓ 実装をコミット
7. /create-pr
   ↓ PRを作成
```

---

## 複数人での分担

### 基本方針

- **最初にAPI仕様とDB設計を決める**
- **1人が1画面（機能）を縦に担当**（フロント→API→結合）
- **並行作業時は担当範囲を明確に**

### 例：ユーザー管理機能を2人で開発

**Step 1: API仕様とDB設計を決める**

全員で以下を決定：
- エンドポイント一覧
- リクエスト/レスポンス形式
- テーブル設計

**Step 2: 機能を分割**

- **Aさん**: ユーザー一覧・詳細表示
- **Bさん**: ユーザー作成・編集

**Step 3: 各自で縦に実装**

各自が担当範囲で：
1. フロント（ダミーデータ）
2. API仕様確認
3. バックエンド実装（TDD）
4. 結合

**Step 4: マージ**

各自がPRを作成してマージ

---

## AIへの作業依頼の仕方

### 基本原則：小さく作り、こまめにコミット

**1つの機能/修正ごとに依頼**

- ✅ 小さな単位で依頼
- ✅ 動作確認したらすぐコミット
- ✅ 次の作業へ

### 作業の流れ（例：新機能の追加）

```
あなた: 「ユーザー一覧APIのテストを作って」
AI: （テスト作成）
あなた: （確認）「OK、/commit」
AI: （コミット: test: ユーザー一覧APIのテストを追加）

あなた: 「テストが通る実装をして」
AI: （実装）
あなた: （確認）「OK、/commit」
AI: （コミット: feat: ユーザー一覧APIを実装）

あなた: 「/create-pr」
AI: （PR作成）
```

### やってはいけないこと

#### ❌ 大きな依頼をする

```
❌ 悪い例:
「ユーザー管理機能を全部作って」

✅ 良い例:
「ユーザー一覧表示のテストを作って」
↓
「テストが通る実装をして」
↓
「次はユーザー作成のテストを作って」
```

#### ❌ 複数の変更をまとめてコミット

```
❌ 悪い例:
「テストと実装を作って、まとめてコミット」

✅ 良い例:
「テストを作って」→ /commit
「実装を作って」→ /commit
```

#### ❌ 動作確認せずに次へ進む

```
❌ 悪い例:
AI: 「実装が完了しました」
あなた: 「次の機能を作って」（確認せず）

✅ 良い例:
AI: 「実装が完了しました」
あなた: （動作確認）「OK、/commit」
あなた: 「次の機能を作って」
```

#### ❌ コンテキストが大きくなりすぎるまで続ける

```
❌ 悪い例:
同じセッションで10個の機能を作る

✅ 良い例:
2-3個の機能を作ったら新しいセッションを開始
```

---

## コンテキストが大きくなったら

### 新しいセッションを開始

コンテキストが大きくなりすぎた場合は、新しいセッションを開始してください。

### セッション開始時の伝え方

```
「〇〇の続きをやります。前回は△△まで完了しています」

例:
「ユーザー管理機能の続きをやります。
 前回はユーザー一覧とユーザー作成が完了しています。
 今回はユーザー編集を実装します」
```

### AIはコミット履歴から状況を把握できる

- AIはGit履歴を確認できる
- コミットメッセージから何が完了しているか分かる
- コードから現状を理解できる

---

## 開発の全体フロー

### 1. Issue作成

```
/create-issue
```

- 作業内容を明確にする
- 受け入れ条件を記載する

詳細は [ISSUE_RULES.md](ISSUE_RULES.md) を参照してください。

### 2. ブランチ作成

```bash
git checkout -b feat/123-user-list
```

ブランチ命名規則は [GIT_RULES.md](GIT_RULES.md) を参照してください。

### 3. TDDで実装

```
1. /create-test（テスト作成）
2. /commit（テストコミット）
3. /implement-for-test（実装）
4. /commit（実装コミット）
```

詳細は [TESTING.md](TESTING.md) を参照してください。

### 4. コードレビュー

```
/code-review
```

詳細は [CODING_RULES.md](CODING_RULES.md) と [SECURITY.md](SECURITY.md) を参照してください。

### 5. PR作成

```
/create-pr
```

詳細は [GIT_RULES.md](GIT_RULES.md) を参照してください。

### 6. レビュー・マージ

- レビュアーのフィードバックに対応
- 承認されたらマージ

### 7. ブランチ削除

```bash
git branch -d feat/123-user-list
```

---

## よくある質問

### Q: フロントとバックを同時に開発しても良い？

**A: フロント先行を推奨します**

理由：
- 画面を先に作ることで、必要なデータが明確になる
- API仕様が固まってから実装した方が手戻りが少ない

ただし、以下の場合は同時開発もOK：
- API仕様が既に明確
- 小さな機能

### Q: テストは必須？

**A: はい、必須です**

- TDDを採用しているため、テストなしでの実装は認めません
- テストがあることで、リファクタリングやバグ修正が安全になります

### Q: AIにすべて任せても良い？

**A: いいえ、必ず確認してください**

- AIが生成したコードは必ずレビューする
- セキュリティ観点でのチェックは必須（[SECURITY.md](SECURITY.md) 参照）
- 動作確認は必ず行う

### Q: コミットの粒度は？

**A: 小さく、頻繁にコミットしてください**

良い例：
- ✅ test: ユーザー一覧APIのテストを追加
- ✅ feat: ユーザー一覧APIを実装
- ✅ docs: API仕様書を更新

悪い例：
- ❌ feat: ユーザー管理機能を実装（テスト、実装、ドキュメントをまとめてコミット）

---

## トラブルシューティング

### テストが失敗する

1. `/code-review` でコードをレビュー
2. エラーメッセージを確認
3. [TESTING.md](TESTING.md) を参照
4. 不明な場合は開発者に質問

### コンフリクトが発生した

1. 最新のmainブランチを取得
2. 自分のブランチにマージ
3. コンフリクトを解決
4. テストを実行して動作確認

詳細は [GIT_RULES.md](GIT_RULES.md) を参照してください。

### AIのコンテキストが大きくなった

1. 現在の作業をコミット
2. 新しいセッションを開始
3. 「〇〇の続きをやります」と伝える

---

## 参考資料

- [TESTING.md](TESTING.md) - テスト方針
- [GIT_RULES.md](GIT_RULES.md) - Git運用ルール
- [ISSUE_RULES.md](ISSUE_RULES.md) - Issue運用ルール
- [CODING_RULES.md](CODING_RULES.md) - コード規約
- [SECURITY.md](SECURITY.md) - セキュリティ設計

---

## 更新履歴

- **[日付]**: ドキュメント作成
