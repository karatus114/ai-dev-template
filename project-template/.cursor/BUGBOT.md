# BugBot レビュールール

以下のドキュメントに従ってレビューしてください：

- **docs/CODING_RULES.md** - コード規約
- **docs/SECURITY.md** - セキュリティ設計
- **docs/ARCHITECTURE.md** - 設計方針
- **docs/TESTING.md** - テスト方針

---

## 特に注意してチェックする点

### セキュリティ

- [ ] **入力検証が実装されているか**
  - バリデーションライブラリ（Zod, Pydantic等）を使用しているか
  - すべてのユーザー入力を検証しているか

- [ ] **SQLインジェクション対策**
  - ORMを使用しているか
  - パラメータバインディングを使用しているか
  - 生のSQLを直接実行していないか

- [ ] **機密情報のハードコード**
  - APIキー、パスワード、トークンがハードコードされていないか
  - 環境変数（.env）を使用しているか

- [ ] **エラーハンドリング**
  - エラーが適切にキャッチされているか
  - エラーログが出力されているか
  - エラーメッセージに機密情報が含まれていないか

- [ ] **認証・認可の実装漏れ**
  - 認証が必要なエンドポイントに認証チェックがあるか
  - 権限チェックが実装されているか
  - JWTの検証が適切に行われているか

- [ ] **XSS対策**
  - ユーザー入力が適切にエスケープされているか
  - dangerouslySetInnerHTML等の危険なAPIを使用していないか
  - Content-Security-Policyが設定されているか

- [ ] **パスワード管理**
  - パスワードがハッシュ化されているか（bcrypt, argon2）
  - パスワードが平文でログに出力されていないか

---

## レビュー時の観点

### 1. セキュリティ上の問題がないか

**チェック項目**:
- 入力検証
- SQLインジェクション対策
- XSS対策
- 機密情報の管理
- 認証・認可

**重要度**: ⚠️ 最優先

### 2. docs/ のルールに違反していないか

**チェック項目**:
- コード規約（命名規則、インポート順序等）
- レイヤー構成（Controller → Service → Repository）
- データベース設計（テーブル名、カラム名、必須カラム）
- ログ出力（JSON形式、イベント命名）

**重要度**: 🔵 高

### 3. テストが書かれているか

**チェック項目**:
- ユニットテストが存在するか
- 正常系、異常系、境界値がカバーされているか
- テストがパスしているか

**重要度**: 🔵 高

### 4. エラーケースが考慮されているか

**チェック項目**:
- try-catch が適切に実装されているか
- エラーログが出力されているか
- エラー時に適切なHTTPステータスコードが返されるか
- ユーザーに適切なエラーメッセージが表示されるか

**重要度**: 🟡 中

### 5. パフォーマンスに影響がないか

**チェック項目**:
- N+1問題が発生していないか
- 不要なループがないか
- 適切なインデックスが設定されているか

**重要度**: 🟡 中

### 6. コードの品質

**チェック項目**:
- 関数が単一責任か
- コードの重複がないか
- 不要なコメントやconsole.log()がないか

**重要度**: 🟢 低

---

## レビューコメントの形式

以下の形式でコメントを記載してください：

```
[重要度] カテゴリ: 問題の概要

**問題**:
具体的な問題の説明

**該当箇所**:
ファイル名:行番号

**修正案**:
具体的な修正方法

**参考**:
docs/XXX.md - セクション名
```

### 例

```
⚠️ セキュリティ: 入力検証なし

**問題**:
ユーザー入力がバリデーションなしで使用されています。

**該当箇所**:
src/services/UserService.ts:23

**修正案**:
Zodなどのバリデーションライブラリを使用してください。

\`\`\`typescript
import { z } from 'zod';

const userSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8),
});

const validatedData = userSchema.parse(userData);
\`\`\`

**参考**:
docs/SECURITY.md - 入力検証
```

---

## 重要度の定義

| 重要度 | 説明 | 対応 |
|-------|------|------|
| ⚠️ 最優先 | セキュリティ、データ損失のリスク | 即座に修正 |
| 🔵 高 | 保守性、拡張性に大きく影響 | 早急に修正 |
| 🟡 中 | パフォーマンス、コード品質に影響 | 修正推奨 |
| 🟢 低 | 読みやすさ、一貫性に影響 | 余裕があれば修正 |

---

## 参考資料

- [docs/CODING_RULES.md](../docs/CODING_RULES.md) - コード規約
- [docs/SECURITY.md](../docs/SECURITY.md) - セキュリティ設計
- [docs/ARCHITECTURE.md](../docs/ARCHITECTURE.md) - 設計方針
- [docs/TESTING.md](../docs/TESTING.md) - テスト方針
- [docs/DATABASE.md](../docs/DATABASE.md) - DB設計ルール
- [docs/LOGGING.md](../docs/LOGGING.md) - ログ規約
